&nbsp;&nbsp;`파일 시스템(File System)`은 파일과 디렉터리를 보조기억장치에 일목요연하게 저장하고 접근할 수 있게 하는 운영체제 내부 프로그램으로 파일 시스템에는 `FAT 파일 시스템`, `유닉스 파일 시스템` 등 다양한 종류가 있습니다. 이번 절에서는 파일 시스템의 동작 방식과 파일 시스템의 종류에 대해 간단히 다루고 있습니다.

<br>

### 파티셔닝과 포매팅

&nbsp;&nbsp;공장에서 생산되어 사용된 적 없는 보조기억장치는 파티션을 나누는 `파티셔닝(Partitioning)`과 포맷 작업을 의미하는 `포매팅(Formatting)`이 필요합니다.

<br>

**1. 파티셔닝(Partitioning)**

- 저장 장치의 논리적인 영역을 가각의 구역으로 나누는 작업입니다.

- 파티셔닝에 의해 나누어직 각 구역을 `파티션(Partition)`이라고 부릅니다.

- 파티셔닝을 통해 저장 장치를 구역화하여 데이터를 효율적으로 관리할 수 있습니다.

**2. 포매팅(Formatting)**

- 일반적으로 저장 장치를 완전히 삭제하는 것으로 알려져 있는 포매팅과는 약간 맥락이 다릅니다.

- 포매팅은 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지 결정하고, 새로운 데이터를 쓸 준비를 하는 작업입니다.

- 포매팅을 통해 저장 장치의 파일 시스템이 결정됩니다.

<br>

### 파일 할당 방법

&nbsp;&nbsp;파일 시스템이 파일과 디렉토리를 보조기억장치에 쓸 때에는 `블록(Block)`단위로 읽고 쓰게 됩니다. 블록은 하드 디스크의 가장 작은 저장 단위로 하나의 파일은 하나 이상의 블록에 걸쳐 저장됩니다.

<br>

**1. 연속 할당(Contiguous Allocation)**

<figure align="center">
  <img src="../images/파일연속할당.jpeg" style="width: 60%" />
</figure>

- 보조기억장치 내 연속적인 블록에 파일을 할당하는 방식입니다.

- 연속으로 할당된 파일에 접근하기 위해서는 첫 번째 블록의 주소와 블록 단위 길이를 알면 됩니다.

- 단순히 연속적인 블록에 저장하면 되기 때문에 구현이 단순합니다.

- 연속적인 블록의 길이가 모자랄 경우 더 많은 블록을 필요로 하는 파일을 저장할 수 없는 `외부 단편화`를 야기할 수 있습니다.

<br>

**2. 연결 할당(Linked Allocation)**

<figure align="center">
  <img src="../images/파일연결할당.jpeg" style="width: 80%" />
</figure>

- 블록의 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식입니다.

- 파일을 이루는 데이터는 연결 리스트로 관리됩니다.

- `불연속 할당`의 일종으로 연속 할당의 `외부 단편화` 문제를 해결할 수 있습니다.

- 마지막 블록에는 다음 불록이 없다는 사전에 정의된 특수한 표시자가 기롭됩니다.(그림 예시에서는 -1을 사용되었습니다)

- 연결 할당을 일부 변형한 `FAT 파일 시스템`은 많이 사용되는 파일 시스템 중 하나입니다.

<br>

> ❗️ **연결 할당의 문제점**
>
> **1. 느린 임의 접근 속도**
>
> &nbsp;&nbsp;`임의 접근`이란 파일 내 임의의 블록에 접근하는 것을 의미하는데 연결 할당의 경우 첫 블록부터 차례로 블록에 접근해야 하는 특성으로 읨의 접근 속도가 느리다는 단점이 있습니다.
>
> **2. 낮은 안정성**
>
> &nbsp;&nbsp;하나의 블록에 파일 데이터와 다음 블록 주소 모두가 저장되기 때문에 만약 중간 블록이 하드웨어 고장 또는 오류로 접근이 불가능 하다면 그 이후 모든 블록에 접근할 수 없다는 단점이 있습니다.

<br>

**3. 색인 할당(Indexed Allocation)**

<figure align="center">
  <img src="../images/파일색인할당.jpeg" style="width: 80%" />
</figure>

- 파일의 모든 블록 주소를 `색인 블록(Index Block)`이라는 하나의 블록에 모아 관리하는 방식입니다.

- 색인 블록의 i번째 항목이 가리키는 블록에 접근하는 방식으로 바로 임의의 블록에 접근하는 임의 접근 속도가 빠릅니다.

- 디렉터리 엔트리에는 파일 이름과 함께 색인 블록 주소를 명시하며, 색인 블록 주소를 통해 색인 블록에 접근하고 색인 블록을 통해 파일 데이터에 접근합니다.

- 색인 할당을 기반으로 한 `유닉스 파일 시스템`이 있습니다.

<br>

### 파일 시스템 살펴보기

**1. FAT(File Allocation Table) 파일 시스템**

<figure align="center">
  <img src="../images/FAT파일시스템_파티션.jpeg" style="width: 80%" />
</figure>

- `FAT 파일 시스템`은 연결 할당의 단점을 보완한 파일 시스템으로 USB 메모리, SD 카드 등의 저용량 저장 장치에 많이 사용되며 옛날 MS-DOS에서 사용되었습니다.

- 기존의 연결 할당에서는 다음 블록의 주소를 이전 블록에서 관리했지만 FAT 파일 시스템은 다음 블록의 주소들을 하나로 모아 테이블 형태로 관리하며 이를 `파일 할당 테이블(File Allocation Table, FAT)`라고 부릅니다.

- 임의 접근 속도와 안정성 문제를 해소할 수 있습니다.

- FAT 파일 시스템의 버전에 따라 FAT12, FAT16, FAT32 등으로 나뉘며 뒤의 숫자는 블록을 표현하는 비트 수를 의미합니다.

- 윈도우 운영체제의 경우 FAT 파일 시스템의 블록을 `클러스터(Cluster)`라고 표현합니다.

<br>

**2. 유닉스 파일 시스템**

<figure align="center">
  <img src="../images/유닉스파일시스템_파티션.jpeg" style="width: 80%" />
</figure>

- `유닉스 파일 시스템`은 `색인 할당` 기반의 파일 시스템입니다.

- 유닉스 파일 시스템에서 색인 할당의 색인 블록을 `i-node(index-node)`라고 부릅니다.

- i-node에는 15개의 블록 주소가 저장될 수 있으며 일반적으로 12개의 주소만으로 파일의 데이터 블록을 모두 가리킬 수 있다면 12개에는 파일 데이터가 저장된 블록의 주소를 명시한 `직접 블록 주소`를 저장합니다.

- 만약 충분하지 않다면 13번째의 주소에 `단일 간접 블록 주소`를 저장하며 단일 간접 블록은 다시 파일 데이터가 저장된 블록의 주소를 가리킵니다.

- 위의 방식으로도 충분하지 않다면 14번째 주소에는 `이중 간접 블록 주소`를 저장하고 이중 간접 블록은 다시 단일 간접 블록의 주소를 가리킵니다.

- 이로도 충분하지 않다면 15번째 주소는 `삼중 간접 블록 주소`를 저장하고 삼중 간접 블록은 이중 간접 블록의 주소를 가리킵니다. 이중 간접 블록에는 마찬가지로 단일 간접 블록의 주소가 저장되어 있습니다.

<br>

**3. NT 파일 시스템(NTFS)**

- 윈도우 운영체제에서 사용되는 파일 시스템입니다.

<br>

**4. ext 파일 시스템**

- 리눅스 운영체제에서 사용되는 파일 시스템입니다.

<br>

> 💡 `저널링 파일 시스템`
>
> &nbsp;&nbsp;저널링 파일 시스템은 `저널링(journaling) 기법`이라는 작업 로그를 통해 시스템 크래시가 발생했을 때 빠르게 복구하기 위한 기법을 활용한 파일 시스템입니다. 저널링 파일 시스템의 파티션에는 `로그 영역`에 작업직전 수행하는 작업에 대한 로그를 남기고, 작업이 완료되면 로그를 삭제하는 방식을 사용합니다. 만약 작업 도중 시스템 크래시가 발생했다면 파일 시스템 전체를 검사할 필요없이 로그 영역에 남긴 로그를 확인해 복구하는 과정을 거칩니다.
>
> &nbsp;&nbsp;MS의 NTFS, 리눅스의 ext3, ext4 파일 시스템을 포함한 현대 대부분의 파일 시스템은 저널링 기능을 지원하고 있습니다.

<br>

> 💡 `마운트(Mount)`
>
> &nbsp;&nbsp;마운트는 한 저장 장치의 파일 시스템에서 다른 저장 장치의 파일 시스템에 접근할 수 있도록 파일 시스템을 편입시키는 작업을 의미합니다. 일반적으로 컴퓨터에 새로운 USB 메모리를 꽂는다면 기존의 드라이브 파일 시스템에 USB 메모리에 포함된 파일 시스템이 마운트된 것입니다. 유닉스, 리눅스와 같은 운영체제에서 다양한 저장 장치를 컴퓨터에 연결할 때 `mount` 명령어를 사용하여 마운트합니다.

<br>
