
&nbsp;&nbsp;웹 서비스의 화면이 사용자에게 보여지기 까지 뒤에서는 많은 과정이 필요합니다. 본문은 사용자의 브라우저로부터 HTTP 요청이 발생되고, 네트워크에서 처리되는 많은 과정은 생략하고 서버가 응답으로 반환한 정적파일에서 어떤 단계를 거쳐 화면에 그려지는 렌더링의 과정을 살펴보도록 하겠습니다.

<br>

## 렌더링 과정

&nbsp;&nbsp;브라우저 요청으로 서버가 반환하는 리소스에는 HTML, CSS, Javascript와 같은 정적 파일이 있습니다. 브라우저는 서버로부터 받은 리소스를 활용해 다음과 같은 과정으로 렌더링을 실시합니다.

<br>

### 1. HTML 파싱(Parsing)

&nbsp;&nbsp;브라우저는 수신 HTML 파일을 가지고 DOM을 생성합니다. HTML은 순수한 텍스트로 이루어진 문서로 브라우저가 HTML에 담긴 텍스트를 토대로 브라우저가 이해할 수 있는 자료구조로 변환하는데 이를 파싱(Parsing)이라 부릅니다. 이제 간단한 예시로 브라우저가 HTML를 DOM으로 파싱하는 과정을 살펴보겠습니다.

<br>

**DOM 트리 구축과정**

1. 브라우저는 서버로부터  HTML 문서를 2진수의 바이트 형태로 응답받습니다. 바이트 형태의 HTML은 `meta` 태그의 `charset` 어트리뷰트에 지정된 인코딩 방식에 따라 문자열로 변환됩니다.
2. 렌더링 엔진은 문자열로 변환된 HTML을 읽어 문법적(syntax) 의미를 갖는 최소 단위인 `토큰(token)`으로 분해합니다.
3. 분해된 토큰은 객체로 변환되며 `노드(Node)`를 생성합니다. 토큰의 내용에 따라 문서 노드, 요소 노드, 어트리뷰트 노드, 텍스트 노드가 생성되는데 이러한 노드들은 DOM을 구성하는 기본 요소입니다.
4. HTML을 구성하는 요소들은 서로 중첩(Nesting) 관계가 될 수 있습니다. 텍스트 역시 다른 요소 사이에 위치할 수 있으며, HTML 요소 간에 부모-자식 관계를 반영해 모든 노드들은 트리(tree) 자료구조로 구성됩니다. 이렇게 만들어진 자료구조를 `DOM(Document Object Model)`이라고 부릅니다.

<br>

&nbsp;&nbsp;아래 코드는 브라우저가 서버로부터 응답받은 HTML의 내용입니다. 이 파일이 DOM으로 변환되었을 때의 DOM 트리는 코드 하단 이미지와 같이 만들어집니다.

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Sample</title>
    <link rel="stylesheet" href-"style.css">
  </head>
  <body>
    <ul data-list="fruit">
      <li id="apple">Apple</li>
      <li id="banana">Banana</li>
      <li id="orange">Orange</li>
    </ul>
  </body>
</html>
```

![DOM 트리 예시](../images/DOM_tree01.png)

<br>

### 2. CSS 파싱

&nbsp;&nbsp;브라우저의 `렌더링 엔진`은 HTML 문서를 파싱해 DOM을 생성하는 과정을 HTML의 처음부터 한 줄씩 순차적으로 진행합니다.브라우저가 DOM 트리를 만드는 프로세스는 메인 쓰레드를 차지하는데, 만약 중간에 `link`나 `style`, `script` 태그들을 만나면 렌더링 엔진은 DOM 생성을 일시 중지하고 각 태그의 `href` 속성에 지정된 CSS 파일을 서버에 요청해 로드한 뒤 HTML과 동일한 과정으로 파싱합니다.

&nbsp;&nbsp;다운로드된 CSS 파일은 파싱되어 `CSSOM(CSS Object Model)`을 생성합니다. 이 역시 DOM과 마찬가지로 파싱을 통해 최종적으로 각 요소를 노드로 변환하고 트리 형태의 자료구조가 만들어집니다. 이때 만들어지는 트리에는 CSS 선택자에 기반한 부모, 자식, 형제 관계의 노드도 포함될 수 있습니다. CSS 파싱이 완료되면 HTML 파싱이 중단된 지점부터 다시 HTML 파싱을 재개합니다.

<br>

>[!tip] CSSOM 상속
>
>&nbsp;&nbsp;CSS의 스타일 속성은 상속될 수 있다는 특징이 있습니다. CSSOM 역시 CSS의 상속을 반영하며, 위 예시 코드에서 `ul` 태그에 `list-style: none`이 지정되어 있었다면 자식 요소인 `li` 태그는 이를 상속 받아 CSSOM 노드를 생성합니다.

<br>

**Preload Scanner**

&nbsp;&nbsp;앞서 이야기 했듯 HTML을 파싱하는 과정 중에 `link`나 `script`를 만나면 파싱을 중단하고 해당 요소에 지정된 리소스를 다운받아 파싱한다고 했습니다. 이러한 리소스는 DOM의 생성을 지연시키기 때문에 `렌더링 블로킹 리소스(Rendering Blocking Resource)`라고 불립니다. `Preload Scanner`는 블로킹 리소스가 다른 중요한 리소스를 활용하는 프로세스를 차단 함으로 발생하는 성능 저하 이슈를 해결하기 위해 사용됩니다. 이에 대한 자세한 내용은 [서비스 최적화](../서비스%20최적화/Preload%20Scanner)에 관한 포스트에서 다뤄보도록 하겠습니다.

<br>

### 3. 렌더 트리 생성

&nbsp;&nbsp;파싱을 통해 생성된 `DOM`과 `CSSOM`은 서로 독립적인 자료 구조로 이 둘은 렌더링을 위해 합쳐져 `렌더 트리(Render Tree)`를 생성하게 됩니다. 완성된 렌더 트리는 각 HTML 요소의 위치와 크기를 계산해 레이아웃을 잡고, 브라우저 화면 픽셀을 렌더링하는 `페인팅(Painting)` 처리에 사용됩니다.

<br>

**렌더링 과정**

1. 파싱(Parsing) : HTML과 CSS 파싱을 거쳐 DOM과 CSSOM를 생성
2. 렌더 트리(Render Tree) : DOM과 CSSOM으로 렌더 트리 생성
3. 레이아웃(Layout) : 레이아웃에 변경이 발생했다면 요소의 크기와 위치를 조정하는 단계
4. 페인트(Paint) : 브라우저 화면 픽셀 렌더링을 통해 UI 표현

<br>

&nbsp;&nbsp;렌더링 과정에서 `레이아웃`은 주로 `리렌더링(Rerendering)` 과정에서 발생합니다. 자바스크립트에 의해 새로운 노드가 추가/삭제되거나 HTML의 레이아웃에 변경을 야기할 수 있는 `width, height, margin, padding, display, position` 등의 스타일이 수정된 경우, 혹은 


<br>

**References**
- [모던 자바스크립트 Deep Dive, 브라우저의 렌더링 과정](https://m.yes24.com/Goods/Detail/92742567)
- [MDN Docs, 브라우저는 어떻게 동작하는가](https://developer.mozilla.org/ko/docs/Web/Performance/How_browsers_work)
- [브라우저의 프리로드 스캐너](https://yceffort.kr/2022/06/preload-scanner)
