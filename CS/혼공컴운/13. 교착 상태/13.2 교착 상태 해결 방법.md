## 13.2 교착 상태 해결 방법

&nbsp;&nbsp;교착 상태를 해결하기 위해서 예방, 회피, 검출 및 회복 3가지 방법을 사용할 수 있습니다. 이번 절에서는 각각에 대해 다뤄보겠습니다.

<br>

### 교착 상태 예방

&nbsp;&nbsp;교착 상태를 예방하기 위해서는 앞 절에서 다룬 교착 상태 발생 조건 4가지 중 하나를 충족하지 못하게 하는 것입니다. 교착 상태를 예방하는 방법들은 교착 상태가 발생하지 않음을 보장할 수는 있지만 여러 부작용이 발생할 수 있습니다.

<br>

**1. 상호 배제**

- 자원의 상호 배제를 없애는 것은 하나의 모든 자원을 공유가능하게 만든다는 것을 의미합니다.

- 이론적으로는 교착 상태를 없앨 수 있지만, <mark>현실적으로 모든 자원의 상호 배제를 없애는 것은 어렵습니다.</mark>

**2. 점유와 대기**

- 점유와 대기를 없앤 운영체제는 특정 프로세스에 모든 자원을 모두 할당하거나, 할당하지 않습니다.

- 당장 자원이 필요해도 자원을 할당 받지 못하는 프로세스와 사용하지 않으면서 자원을 점유하고 있는 프로세스가 많이 발생할 수 있기 때문에 `자원 사용률`이 낮다는 단점이 있습니다.

- 점유와 대기를 없애면 상대적으로 많은 자원을 사용하는 프로세스가 자원을 적게 사용하는 프로세스보다 자원을 할당받기 어렵기 때문에 `기아 현상`이 야기될 수 있습니다.

**3. 비선점**

- 비선점을 없애면 다른 프로세스가 사용 중인 자원을 빼앗아 사용할 수 있습니다.

- CPU는 대표적으로 프로세스들이 선점할 수 있는 자원이지만 <mark>프린터와 같이 일부 선점이 불가능한 자원도 있기 때문</mark>에 비선점을 없애는 것은 범용성이 떨어지는 방법입니다.

**4. 원형 대기**

- 모든 자원에 번호를 붙이고 오름차순으로 자원을 할당하면 원형 대기를 없앨 수 있습니다.

- 식사하는 철학자 문제에서는 마치 원형 식탁이 아닌 사각형 식탁에 일렬로 앉아있는 상황과 유사합니다.

- 모든 컴퓨터 시스템 자원에 번호를 할당하는 것은 간단한 작업이 아니며 방법에 따라 특정 자원의 활용률이 떨어질 수 있다는 단점이 있습니다.

<br>

### 교착 상태 회피

&nbsp;&nbsp;`교착 상태 회피`는 <mark>한정된 자원을 무분별하게 할당함으로 교착 상태가 발생할 수 있음</mark>을 문제로 삼고 있기 때문에 교착 상태가 발생하지 않을 정도로만 자원을 조심스럽게 할당하는 방식을 사용합니다. 만약 식사하는 철학자 문제에서 사용할 수 있는 포크가 무한정 있었다면 교착 상태는 발생하지 않았을 것입니다.

<br>

> 💡 안전 상태와 불안전 상태
>
> &nbsp;&nbsp;먼저 `안전 순서열(safe sequence)`은 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서를 의미합니다. 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 안전 순서열이 있는 상태를 `안전 상태(safe state)`, 안전 순서열이 하나도 없어 교착 상태가 발생할 수 있는 상태를 `불안전 상태(unsafe state)`라고 부릅니다.

<br>

| 프로세스 | 요구량 | 현재 사용량 | 안전 순서열 | 프로세스 | 요구량 | 현재 사용량 | 안전 순서열 |
| -------- | ------ | ----------- | ----------- | -------- | ------ | ----------- | ----------- |
| P1       | 10     | 5           | 3           | P1       | 10     | 5           | X           |
| P2       | 4      | 2           | 1           | P2       | 4      | 2           | X           |
| P3       | 9      | 2           | 2           | P3       | 9      | 2 + 1       | X           |

<br>

&nbsp;&nbsp;위 표의 좌우 두 가지 예시에 대해 만약 할당 가능한 자원이 12개라면 왼쪽은 P2 -> P3 -> P1 순으로 안전 순서열이 존재하지만 P3가 사용 가능한 자원을 한개 더 가지고 있는 상황에서는 어떤 방법으로도 안전 순서열 존재하지 않습니다. 안전 순서열이 존재하지 않은 두 번째 예시와 같은 상황을 `불안전 상태`, 안전 순서열이 존재하는 첫 번째 예시를 `안전 상태`라고 할 수 있습니다. 운영체제가 교착 상태를 회피하기 위해서는 <mark>시스템이 안전 상태를 유지할 수 있도록 자원을 할당하는 방식을 취해야합니다.</mark>

<br>

### 교착 상태 검출 후 회복

&nbsp;&nbsp;교착 상태 발생 자체를 막기 위한 예방 및 회피와 다르게 `교착 상태 검출 후 회복`은 교착 상태 발생을 인정하고 사후 조치를 하는 방식입니다. 운영체제는 프로세스들이 자원을 요구할 때마다 할당할 수 있는 자원을 모두 할당하며 주기적으로 교착 상태 발생 여부를 검사하고, 교착 상태가 검출되면 다음과 같은 방법들을 통해 회복합니다.

<br>

**1. 선점을 통한 회복**

- 교착 상태가 해결될 때까지 다른 프로세스로부터 자원을 강제로 빼앗아 한 프로세스에 할당하는 방식입니다.

**2. 프로세스 강제 종료를 통한 회복**

- 교착 상태를 해결하기 위한 가장 확실한 방법으로 2가지 방식이 있습니다.

- 하나는, 교착 상태에 놓인 프로세스를 모두 강제 종료하는 방식으로 많은 프로세스들이 작업 내역을 잃을 수 있다는 문제가 있습니다.

- 다음은,교착 상태가 없어질 때까지 한 프로세스씩 강제 종료하는 방식입니다. 작업 내역을 잃는 프로세스를 줄일 수 있다는 장점은 있지만 교착 상태가 없어졌는지 검사하는 과정에서 오버헤드가 발생합니다.

<br>

> 💡 타조 알고리즘
>
> &nbsp;&nbsp;드물게 발생하는 잠재적 문제를 무시한다는 관점에서 교착 상태를 아예 무시하는 방식입니다. 문제 발생의 빈도나 심각성에 따라 적합한 방식이 될 수도 있다고 합니다.

<br>
