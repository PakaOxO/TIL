## 10.1 프로세스 개요

&nbsp;&nbsp;`프로세스(process)`는 실행 중인 프로그램으로 보조장치에 저장 되어있는 프로그램이 실행하기 위해 메모리에 적재되는 순간 프로그램은 프로세스가 됩니다.

<br>

### 프로세스 직접 확인하기

- 프로세스는 윈도우에서는 [작업 관리자] - [프로세스 탭]에서 확인할 수 있고, 유닉스 체계의 운영체제에서는 ps 명령어로 확인할 수 있습니다.

- **포그라운드 프로세스(foreground process)** : 사용자가 보는 앞에서 실행되는 프로세스

- **백그라운드 프로세스(background process)** : 사용자가 보지 못하는 뒷편에서 실행되는 프로세스

- 백그라운드 프로세스에는 사용자와 상호작용하는 프로세스와, 사용자와 상호작용하지 않고 자신의 할일을 수행하는 종류가 있는데, 이 중 후자를 유닉스 체계의 운영체제에서는 `데몬(daemon)`, 윈도우 운영체제에서는 `서비스(service)`라고 부릅니다.

<br>

### 프로세스 제어 블록

&nbsp;&nbsp;CPU의 자원은 한정적이기 때문에 하나의 프로세스가 정해진 시간만큼 CPU를 이용했다면, 다음 프로세스로 차례를 넘겨야합니다. `타이머 인터럽트`는 **타임아웃 인터럽트**라고도 불리며 타이머 인터럽트가 발생했다면, 작업하던 프로세스의 내용을 백업하고 다음 프로세스의 작업을 시작합니다.

<br>

<figure align="center">
  <img src="../images/%ED%83%80%EC%9D%B4%EB%A8%B8%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8.jpg" style="width: 400px" />
</figure>

<br>

&nbsp;&nbsp;운영체제는 <mark>프로세스의 실행 순서를 관리하고, 프로세스에 CPU를 비롯한 자원을 배분</mark>하기 위해 `프로세스 제어 블록(process control block, PCB)`을 이용합니다. 프로세스 제어 블록은 프로세스와 관련된 정보를 저장하고 있는 자료구조로 <mark>프로세스를 식별</mark>하기 위해 필요한 정보들이 저장됩니다.

<br>

**프로세스 제어 블록(PCB)의 특징**

- 프로세스 제어 블록은 메모리의 커널 영역에 생성됩니다.

- 운영체제는 PCB를 통해 특정 프로세스를 식별하고 해당 프로세스를 처리하는 필요한 정보를 판단합니다.

- PCB는 운영체제에 의해 프로세스 생성 시에 만들어지고, 실행이 끝나면 폐기됩니다.

<br>

**프로세스 제어 블록(PCB) 대표 정보**

1. `프로세스 ID (process ID, PID)` :특정 프로세스를 식별하기 위해 부여되는 고유한 번호입니다.

2. `레지스터 값` : 자신의 실행 차례가 돌아왔을 때 실행을 재개하기 위해 이전에 사용했던 프로그램 카운터를 포함한 레지스터의 값들을 저장합니다.

3. `프로세스 상태` : 현재 프로세스가 어떤 상태인지 파악하기 위한 상태 정보를 저장합니다.

4. `CPU 스케줄링 정보` : 프로세스가 언제, 어떤 순서로 CPU를 할당받을지에 대한 정보를 저장합니다.

5. `메모리 관리 정보` : 프로세스마다 메모리에 저장된 위치가 다르기 때문에 프로세스가 어느 주소에 저장되어 있는지 파악하기 위해 베이스 레지스터, 한계 레지스터 값과, 페이지 테이블 정보와 같은 정보들을 저장합니다.

6. `사용한 파일과 입출력장치 목록` : 프로세스 실행 과정에서 사용한 입출력장치나 파일의 내용이 저장됩니다.

<br>

### 문맥 교환

&nbsp;&nbsp;프로세스 A가 운영체제에 의해 CPU를 할당받아 실행하다 시간이 다 되어 프로세스 B로 CPU 사용을 양도해야 할 경우 다음 프로세스 실행을 재개하기 위해 기억해야할 정보가 필요합니다. 프로그램 카운터를 포함한 레지스터 정보와 메모리 정보, 실행을 위해 사용한 파일이나 입출력장치들을 포함하는 정보를 `문맥(context)`라고 부릅니다.

<br>

**문맥(context)의 특징**

- 하나의 프로세스 문맥은 해당 프로세스의 PCB에 저장되어 있습니다.
- 프로세스가 예기치 못한 일로 종료되거나 할당된 시간이 다되어 작업을 종료하고 다음 프로세스로 차례를 넘겨야 할 경우 문맥은 해당 프로세스의 PCB에 백업합니다.
- 기존 프로세스의 문맥을 PCB에 저장하고, 새로운 프로세스를 실행하기 위한 문맥을 PCB로부터 복구하여 실행하는 것을 `문맥 교환(context switching)`이라고 합니다.

<br>

### 프로세스의 메모리 영역

&nbsp;&nbsp;하나의 프로세스가 생성되면 커널 영역에는 PCB가 생성되며, 사용자 영역에는 `코드 영역`, `데이터 영역`, `힙 영역`, `스택 영역`으로 구분하여 저장됩니다. 이 중 `코드 영역`과 `데이터 영역`은 크기가 변하지 않아 크기가 고정된 영역인 `정적 할당 영역`이라고 부르며, `힙 영역`과 `스택 영역`은 프로세스 실행 과정에서 크기가 변할 수 있어 `동적 할당 영역`이라고 부릅니다.

<br>

<figure align="center">
  <img src="../images/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%98%81%EC%97%AD.jpg" style="width: 300px" />
</figure>

<br>

**1. 코드 영역(code segment)**

- 실행할 수 있는 코드인 기계어로 이루어진 명령어가 저장되는 영역입니다.

- CPU가 실행할 명령어가 담겨 있기 때문에 쓰기가 금지되어 있는 `읽기 전용(read-only)` 공간입니다.

- 코드 영역은 텍스트 영역(text segment)라고도 부릅니다.

<br>

**2. 데이터 영역**

- 프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간입니다.

- 대표적으로 `전역 변수(global variable)`이 저장됩니다.

<br>

**3. 힙 영역**

- 프로그래머가 직접 할당할 수 있는 저장 공간입니다.

- 메모리 공간에 힙 영역을 할당을 했다면 이를 운영체제에 반환하는 과정도 필요합니다.

- 만약 메모리 공간이 반환되지 않는다면 메모리의 낭비 현상인 `메모리 누수(memory leak)`가 발생할 수 있습니다.

- 메모리의 낮은 주소에서 높은 주소로 할당됩니다.(스택 영역과 겹치는 것을 방지)

<br>

**4. 스택 영역**

- 정적 할당 영역인 데이터 영역과 달리 데이터를 일시적으로 저장하는 공간입니다.

- 대표적으로 `매개 변수`, `지역 변수` 등이 저장됩니다.

- 메모리 주소가 높은 주소에서 낮은 주소로 할당됩니다.(힙 영역과 겹치는 것을 방지)

<br>
